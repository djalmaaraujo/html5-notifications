// Generated by CoffeeScript 1.6.2
/*
  HTML5 Notifications
  - dependencies: jQuery

  @djalmaaraujo
*/


(function() {
  var $;

  $ = jQuery;

  this.Notifications = (function() {
    function Notifications(authorize) {
      if (authorize) {
        this.checkForPermission();
      }
    }

    Notifications.prototype.isAuthorized = function() {
      if (!this.apiAvailable()) {
        return false;
      }
      return window.webkitNotifications.checkPermission() === 0;
    };

    Notifications.prototype.apiAvailable = function() {
      return window.webkitNotifications;
    };

    Notifications.prototype.authorize = function(cb) {
      if (!this.apiAvailable()) {
        return false;
      }
      return webkitNotifications.requestPermission(cb);
    };

    Notifications.prototype.show = function(url, title, body) {
      var popup,
        _this = this;

      if (!this.apiAvailable()) {
        return false;
      }
      if (this.isAuthorized()) {
        popup = window.webkitNotifications.createNotification(url, title, body);
        popup.show();
        setTimeout((function() {
          return popup.cancel();
        }), 5000);
        return true;
      } else {
        return this.callForPermission(function() {
          return _this.show(url, title, body);
        });
      }
    };

    Notifications.prototype.checkForPermission = function() {
      if (!this.isAuthorized()) {
        return this.callForPermission();
      }
    };

    Notifications.prototype.callForPermission = function(cb) {
      var authorizeBox,
        _this = this;

      if (!this.apiAvailable()) {
        return false;
      }
      authorizeBox = $('<div />').addClass('notifications-authorize').html('<p>Seu navegador possui suporte a notificações. Para solicitar uma permissão de notificação, clique no botão abaixo. Aperte "ALLOW" ou "PERMITIR" para a janela de notificação que irá aparecer. <input type="button" value="Ativar notificações" /></p>');
      $('body').append(authorizeBox);
      return authorizeBox.find('input').on('click', function() {
        authorizeBox.remove();
        return _this.authorize(cb);
      });
    };

    return Notifications;

  })();

}).call(this);
